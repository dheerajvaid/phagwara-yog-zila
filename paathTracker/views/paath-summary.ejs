<%- include('../views/partials/header') %>
<%- include('../views/partials/navbar') %>

<div class="container my-4 pb-5">

  <!-- ğŸŒ¸ Title -->
  <div class="text-center mb-4">
    <h2 class="fw-bold text-danger">ğŸ”¥ Daily Steps Tracking Summary</h2>
    <p class="text-muted mb-0">Summary of total steps recorded by all members on the selected date</p>
  </div>

  <!-- ğŸ“… Date Picker -->
  <div class="d-flex justify-content-center align-items-center mb-4">
    <label for="summaryDate" class="me-2 fw-semibold text-secondary">ğŸ“… Select Date:</label>
    <input type="date" id="summaryDate"
           class="form-control border-danger shadow-sm rounded-pill text-center fw-semibold"
           style="max-width: 200px;"
           value="<%= selectedDate || new Date().toISOString().slice(0, 10) %>">
  </div>

  <!-- ğŸŒ Total Steps Card -->
  <div class="card border-0 shadow-lg text-center mb-4 rounded-4 bg-light">
    <div class="card-body py-4">
      <h5 class="fw-bold text-secondary mb-2">Total Steps</h5>
      <h1 id="totalPaath" class="fw-bold text-success display-5 mb-2">
        <%= totalToday %> <span class="fs-5 text-muted">steps</span>
      </h1>
      <p class="text-muted m-0">ğŸ’ª Keep moving, keep growing!</p>
    </div>
  </div>

  <!-- ğŸ‘¥ All Members Table -->
  <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
    <div class="card-header bg-danger text-white text-center fw-bold fs-5 py-3">
      ğŸ”¸ All Members ğŸ”¸
    </div>

    <div class="table-responsive">
      <table class="table align-middle text-center mb-0" id="membersTable">
        <thead class="bg-light">
          <tr class="text-danger fw-semibold">
            <th style="width: 8%;">ğŸ…</th>
            <th style="width: 40%;">Member Name</th>
            <th style="width: 32%;">ğŸ“± Mobile</th>
            <th style="width: 20%;">ğŸ‘£ Steps</th>
          </tr>
        </thead>
        <tbody>
          <% if (topMembers && topMembers.length > 0) { %>
            <% topMembers.forEach((m, i) => { 
                 const rank = i + 1;
                 let badgeClass = "bg-danger";
                 if (rank === 1) badgeClass = "bg-warning text-dark";
                 else if (rank === 2) badgeClass = "bg-secondary";
                 else if (rank === 3) badgeClass = "bg-bronze";
                 const saadhak = m.saadhak[0] || {};
            %>
              <tr class="align-middle">
                <td><span class="fw-bold text-danger fs-5"><%= rank %></span></td>
                <td class="fw-semibold"><%= saadhak.name || 'Unknown' %></td>
                <td class="text-muted"><%= saadhak.mobile || '-' %></td>
                <td><span class="badge <%= badgeClass %> fs-6 px-3 py-2"><%= m.total %></span></td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr>
              <td colspan="4" class="py-4 text-muted fs-6">No steps recorded for this date ğŸ‘Ÿ</td>
            </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ğŸª” Buttons -->
  <div class="text-center mt-4">
    <a href="/paath/add" class="btn btn-danger rounded-pill px-4 py-2 fw-bold shadow-sm me-2">
      â• Add Steps
    </a>
    <a href="/paath/list" class="btn btn-outline-danger rounded-pill px-4 py-2 fw-bold shadow-sm">
      ğŸ“œ View My Activity
    </a>
  </div>

</div>

<%- include('../views/partials/footer') %>

<style>
  .bg-bronze {
    background-color: #cd7f32;
    color: white;
  }
  #summaryDate:focus {
    border-color: #dc3545 !important;
    box-shadow: 0 0 6px rgba(220, 53, 69, 0.4);
  }
  table th, table td {
    vertical-align: middle !important;
  }
  @media (max-width: 576px) {
    h2 { font-size: 1.4rem; }
    .card-header { font-size: 1.1rem; }
    #summaryDate { font-size: 0.9rem; }
    table th, table td { font-size: 0.9rem; }
  }
</style>

<script>
document.getElementById('summaryDate').addEventListener('change', async function() {
  const date = this.value;
  const res = await fetch(`/paath/summary?date=${date}`, { headers: { 'X-Requested-With': 'XMLHttpRequest' } });
  const data = await res.json();

  // Update total steps
  document.getElementById('totalPaath').innerHTML =
    `${data.totalToday} <span class="fs-5 text-muted">steps</span>`;

  // Update members table
  const tbody = document.querySelector('#membersTable tbody');
  tbody.innerHTML = '';

  if (data.topMembers.length > 0) {
    data.topMembers.forEach((m, i) => {
      const rank = i + 1;
      let badgeClass = "bg-danger";
      if (rank === 1) badgeClass = "bg-warning text-dark";
      else if (rank === 2) badgeClass = "bg-secondary";
      else if (rank === 3) badgeClass = "bg-bronze";

      const saadhak = m.saadhak?.[0] || {};
      tbody.innerHTML += `
        <tr>
          <td><span class="fw-bold text-danger fs-5">${rank}</span></td>
          <td class="fw-semibold">${saadhak.name || 'Unknown'}</td>
          <td class="text-muted">${saadhak.mobile || '-'}</td>
          <td><span class="badge ${badgeClass} fs-6 px-3 py-2">${m.total}</span></td>
        </tr>`;
    });
  } else {
    tbody.innerHTML =
      `<tr><td colspan="4" class="py-4 text-muted fs-6">No steps recorded ğŸ‘Ÿ</td></tr>`;
  }
});
</script>
