<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<div class="container my-4">
   <div class="text-end mb-3">
  <a id="exportPDF"
    href="/attendance/report/pdf/<%= saadhak._id %>?month=<%= month %>&year=<%= year %>"
    class="btn btn-sm btn-outline-danger"
    >
    ğŸ–¨ï¸ Export PDF
  </a>
</div>


  <%
    const monthName = new Date(year, month - 1).toLocaleString('default', { month: 'short' });
    const totalDaysPresent = Object.keys(dailyVisits).length;

    const kenderVisitCount = {};
    Object.values(dailyVisits).forEach(kenderName => {
      if (kenderVisitCount[kenderName]) {
        kenderVisitCount[kenderName]++;
      } else {
        kenderVisitCount[kenderName] = 1;
      }
    });
  %>

  <div class="text-center mb-4">
    <h4 class="fw-bold">Attendance for <%= saadhak.name %></h4>
    <h6 class="text-muted"><%= monthName %>-<%= year %></h6>
  </div>

  <div class="mb-3 px-2">
    <p class="fw-semibold mb-1">ğŸ“… <strong>Total Days Present:</strong> <%= totalDaysPresent %> Day<%= totalDaysPresent > 1 ? 's' : '' %></p>

    <% if (Object.keys(kenderVisitCount).length > 0) { %>
      <p class="fw-semibold mb-1">ğŸ  <strong>Kender-wise Attendance:</strong></p>
      <ul class="list-group list-group-flush">
        <% Object.entries(kenderVisitCount).forEach(([kenderName, count]) => { %>
          <li class="list-group-item px-3 py-2 d-flex justify-content-between align-items-center">
            <span><%= kenderName %></span>
            <span class="badge bg-primary rounded-pill"><%= count %> Day<%= count > 1 ? 's' : '' %></span>
          </li>
        <% }) %>
      </ul>
    <% } %>
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-sm text-center align-middle">
      <thead class="table-light sticky-top" style="top: 0; z-index: 1;">
        <tr>
          <th style="min-width: 120px;">Date</th>
          <th style="min-width: 200px;">Kender Visited</th>
        </tr>
      </thead>
      <tbody>
        <% for (let i = 1; i <= lastDayToShow; i++) {
          const date = new Date(year, month - 1, i);
          const day = String(i).padStart(2, '0');
          const monthShort = date.toLocaleString('default', { month: 'short' });
          const yearShort = String(date.getFullYear()).slice(-2);
          const weekdayShort = date.toLocaleString('default', { weekday: 'short' });
          const formattedDate = `${day}-${monthShort}-${yearShort} (${weekdayShort})`;
        %>
          <tr>
            <td><%= formattedDate %></td>
            <td><%= dailyVisits[i] || '-' %></td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <div class="text-center mt-4">
    <a href="/attendance/view" class="btn btn-outline-secondary btn-sm">â† Back to Overview</a>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const exportBtn = document.getElementById("exportPDF");
    
    exportBtn.addEventListener("click", function (e) {
      
      setTimeout(() => {
        if(loadingSpinner) {loadingSpinner.style.display = "none"};
      }, 2000);
    });
  });
</script>

<%- include('../partials/footer') %>
