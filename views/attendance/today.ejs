<%- include('../partials/header') %>
<%- include('../partials/navbar') %>
<!-- views/attendance/today.ejs -->
<section class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Today's Attendance - <%= saadhaks.length %> Present</h2>
    <button id="exportBtn" class="btn btn-sm btn-primary">Download as Image</button>
  </div>

  <!-- Export Area -->
  <div id="attendanceExportWrapper" class="p-4 bg-white border rounded" style="max-width: 800px; margin: auto;">
    <!-- Logo + Title -->
    <div class="text-center mb-4">
      <img src="/images/logo.jpg" alt="BYS Logo" style="height: 60px;" />
      <h3 class="mt-2"><%= kenderName || 'Your Kender Name' %></h3>
      <h5>Attendance Date: <%= attendanceDateFormatted || new Date().toLocaleDateString() %></h5>
      <p class="fw-bold">Total Present: <%= saadhaks.length %></p>
    </div>

    <% if (saadhaks.length === 0) { %>
      <p class="text-center"><%= message %></p>
    <% } else { %>
      <table class="table table-bordered">
        <thead>
          <tr>
            <th>#</th>
            <th>Saadhak Name</th>
            <th>Attendance Status</th>
          </tr>
        </thead>
        <tbody>
          <% saadhaks.forEach((attendance, index) => { %>
            <tr>
              <td><%= index + 1 %></td>
              <td><%= attendance.saadhak.name %></td>
              <td><%= attendance.status === 'Present' ? 'Present' : 'Absent' %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } %>

    <!-- Motivational Footer -->
    <div class="mt-4 text-center">
      <hr />
      <p class="fst-italic text-muted">"Join your nearest Yog Kender today for a healthier body, peaceful mind, and spiritual growth."</p>
      <p class="fw-light">Regular Sadhna brings positivity, strength, and bliss. Be consistent, stay inspired. üßò‚Äç‚ôÇÔ∏è</p>
      <p class="text-primary">~ Bhartiya Yog Sansthan</p>
    </div>
  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
  document.getElementById('exportBtn').addEventListener('click', () => {
    const element = document.getElementById('attendanceExportWrapper');
    html2canvas(element, { scale: 2 }).then(canvas => {
      const link = document.createElement('a');
      link.download = `attendance_${new Date().toISOString().split('T')[0]}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
    });
  });
</script>
  <%- include('../partials/footer') %>