<%- include('./partials/header') %>
<%- include('./partials/navbar') %>

<style>
  .dashboard-card {
    max-width: 420px;
    margin: 0 auto;
    background: #ffffff;
    padding: 2rem 1.5rem;
    border-radius: 1.5rem;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.1);
  }

  .dashboard-card h2 {
    font-size: 1.6rem;
    font-weight: bold;
    color: #1e88e5;
    margin-bottom: 0.5rem;
  }

  .dashboard-card p {
    font-size: 1rem;
    color: #6c757d;
  }

  .dashboard-card .btn {
    font-size: 1.1rem;
    padding: 0.8rem;
    border-radius: 0.75rem;
    position: relative;
  }

  .dashboard-card .badge-calendar {
    position: absolute;
    top: 6px;
    right: 12px;
    font-size: 0.75rem;
    background-color: #dc3545;
    color: white;
    padding: 0.4em 0.6em;
    border-radius: 50%;
  }

  /* Notification Bar */
  #notificationBar {
    max-width: 420px;
    margin: 1rem auto;
    background: linear-gradient(135deg, #1e88e5, #42a5f5);
    color: white;
    border-radius: 1rem;
    overflow: hidden;
    padding: 0.5rem 1rem;
    font-weight: 500;
    white-space: nowrap;
    position: relative;
  }

  #notificationText {
    display: inline-block;
    padding-left: 100%;
    animation: scroll 25s linear infinite;
  }

  @keyframes scroll {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }

  @media(max-width: 480px) {
    .dashboard-card {
      padding: 1.5rem 1rem;
      border-radius: 1rem;
    }

    .dashboard-card h2 {
      font-size: 1.4rem;
    }

    #notificationBar {
      font-size: 0.9rem;
    }
  }
</style>

<!-- Notifications Bar -->
<div id="notificationBar">
  <span id="notificationText"></span>
</div>

<!-- Tip of the Day Modal -->
<div class="modal fade" id="tipModal" tabindex="-1" aria-labelledby="tipModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow-lg border-2" style="max-width: 400px; margin: auto;">
      
      <div class="modal-header bg-success text-white py-2">
        <h5 class="modal-title d-flex align-items-center gap-2" id="tipModalLabel">
          <img src="/images/logo.jpg" alt="Logo"
               width="44" height="44"
               class="rounded-circle me-2 border border-2"
               style="padding: 3px; object-fit: contain; background-color: white;">
          <span>‡§Ü‡§ú ‡§ï‡§æ ‡§Ø‡•ã‡§ó ‡§∏‡§Ç‡§¶‡•á‡§∂</span>
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      
      <div class="modal-body fs-5 text-center text-dark px-4 py-3" style="padding-bottom: 1rem;">
        <p class="mb-0"><%= tipOfTheDay %></p>
      </div>
      
      <div class="modal-footer justify-content-center py-2">
        <button type="button" class="btn btn-outline-success" data-bs-dismiss="modal">üôè ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶</button>
      </div>
      
    </div>
  </div>
</div>

<section class="container mt-5 text-center">
  <div class="dashboard-card">

    <h2>üëã Welcome, <%= user.name %></h2>
    <p class="mb-4">Your mobile: <strong><%= user.mobile %></strong></p>

    <div class="d-grid gap-3">

      <% if (user.roles && user.roles.some(r =>
            ['Kender Pramukh', 'Seh Kender Pramukh', 'Shikshak', 'Karyakarta'].includes(r))) { %>
        <a href="/attendance/mark" class="btn btn-success btn-lg shadow-sm">üìå Mark Attendance</a>
      <% } %>

      <a href="/attendance/top10" class="btn btn-primary btn-lg shadow-sm">üèÜ Top 10</a>
       
      <!-- üåü Update Personal Details Button -->
      <a href="/saadhak/self-update" 
         class="btn btn-gradient btn-lg shadow-sm fw-bold text-white"
         style="background: linear-gradient(135deg, #ff6a00, #ee0979);
                border: none;
                box-shadow: 0 4px 15px rgba(255, 105, 135, 0.3);
                transition: transform 0.2s ease, box-shadow 0.2s ease;">
        ‚úèÔ∏è Update Personal Details
      </a>

      <a href="/calendar/today" class="btn btn-info btn-lg shadow-sm position-relative">
        üìÖ Calendar Events
        <% if (typeof eventCount !== 'undefined' && eventCount > 0) { %>
          <span class="badge-calendar"><%= eventCount %></span>
        <% } %>
      </a>

      <a href="/auth/change-password" class="btn btn-warning btn-lg shadow-sm">üîê Change Password</a>
      <a href="/auth/logout" class="btn btn-danger btn-lg shadow-sm">üö™ Logout</a>
    </div>

  </div>
</section>

<script>
  // Show Tip Modal on page load
  window.addEventListener("load", () => {
    const tipModal = new bootstrap.Modal(document.getElementById('tipModal'));
    tipModal.show();
  });

  // Notifications Array
  const notifications = [
    "üéâ New Feature: Please Update Kender Creation Date under the menu Update Kender Details! or Edit Kender Details",
  ];

  let notifIdx = 0;
  const notifText = document.getElementById("notificationText");

  function showNextNotification() {
    notifText.textContent = notifications[notifIdx];
    notifIdx = (notifIdx + 1) % notifications.length;
  }

  showNextNotification();
  setInterval(showNextNotification, 16000); // Rotate every 8 seconds
</script>

<%- include('./partials/footer') %>
