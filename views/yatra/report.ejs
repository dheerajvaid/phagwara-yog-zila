<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<style>
  .glow-button {
    background: linear-gradient(45deg, #ffe57f, #ffd54f);
    color: #5c3700;
    border: 2px solid #ffca28;
    border-radius: 8px;
    padding: 12px 24px;
    text-shadow: 0 0 5px #fff6e0;
    box-shadow: 0 0 10px #ffeb3b, 0 0 20px #ffd600, 0 0 30px #ffeb3b;
    transition: all 0.3s ease-in-out;
  }

  .glow-button:hover {
    box-shadow: 0 0 20px #ffd600, 0 0 30px #ffeb3b, 0 0 40px #ffd600;
    text-decoration: none;
    transform: scale(1.05);
  }


  .participant-card:hover {
    transform: scale(1.01);
    transition: all 0.3s ease-in-out;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  }

</style>

<div class="container mt-4">
  <h4 class="text-center text-danger">Journey & Ticket Details</h4>

 
  <!-- <div class="row text-center mb-4">
    <div class="col-md-3 col-6 mb-3">
      <div class="p-3 bg-success text-white rounded shadow">
        <div class="fs-4 fw-bold">тЬЕ Register</div>
        <div class="display-6"><%= summary.totalBooked %></div>
      </div>
    </div>
    <div class="col-md-3 col-6 mb-3">
      <div class="p-3 bg-warning text-dark rounded shadow">
        <div class="fs-4 fw-bold">ЁЯкС Left</div>
        <div class="display-6"><%= summary.seatsLeft %></div>
      </div>
    </div>
    <div class="col-md-3 col-6 mb-3">
      <div class="p-3 bg-primary text-white rounded shadow">
        <div class="fs-4 fw-bold">ЁЯСи Male</div>
        <div class="display-6"><%= summary.maleCount %></div>
      </div>
    </div>
    <div class="col-md-3 col-6 mb-3">
      <div class="p-3 bg-danger text-white rounded shadow">
        <div class="fs-4 fw-bold">ЁЯСй Female</div>
        <div class="display-6"><%= summary.femaleCount %></div>
      </div>
    </div>
    <div class="col-md-3 col-6 mb-3">
      <div class="p-3 bg-info text-white rounded shadow">
        <div class="fs-4 fw-bold">ЁЯЪЖ 3AC</div>
        <div class="display-6"><%= summary.ac3Count %></div>
      </div>
    </div>
    <div class="col-md-3 col-6 mb-3">
      <div class="p-3 bg-secondary text-white rounded shadow">
        <div class="fs-4 fw-bold">ЁЯЫПя╕П Sleeper</div>
        <div class="display-6"><%= summary.sleeperCount %></div>
      </div>
    </div>
  </div>

  
  <div class="text-center my-4">
    <img src="/images/krishna-waiting.jpg" alt="Shri Krishna waiting" class="img-fluid" style="max-width: 250px;">
    <p class="mt-3 text-primary fs-5">ЁЯТл I am waiting for you!</p>
  </div> -->

  
  <!-- <div class="text-center mb-4">
    <a href="/vrindavan-trip/temple-timings" class="btn btn-lg btn-warning fw-bold shadow-sm glow-button">
      ЁЯЫХ My Temple Timings
    </a>
  </div> -->

  <!-- ЁЯУд Export Buttons -->
  <!-- <div class="text-end mb-4">
    <a href="/vrindavan-trip/report/pdf" class="btn btn-danger me-2">ЁЯУД Export PDF</a>
    <a href="/vrindavan-trip/report/excel" class="btn btn-success">ЁЯУК Export Excel</a>
  </div> -->

  <!-- ЁЯФН Search -->
  <div class="mb-4">
    <input type="text" id="searchInput" class="form-control" placeholder="ЁЯФН Search by name, mobile or pnr...">
    <button onclick="clearSearch()" class="btn btn-sm btn-outline-secondary mt-2">тЭМ Clear</button>
  </div>

<!-- ЁЯУ▒ Mobile Card View (Compact + Stylish) -->
<div id="yatraCards" class="d-block d-md-none">
  <% yatraList.forEach((y, index) => { %>
    <div class="card mb-3 participant-card border-2 rounded-4 shadow-sm bg-white" style="box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden; border-radius: 16px;">
      
      <!-- ЁЯМ╝ Header Section -->
      <div class="p-3" style="background: linear-gradient(to right, #fff3cd, #ffecb3); border-bottom: 1px solid #f1c40f;">
        <h5 class="mb-1 fw-bold text-danger">
          <%= index + 1 %>. <%= y.name %>
        </h5>
        <div class="d-flex flex-wrap justify-content-between small text-muted">
          <span>ЁЯУ▒ <%= y.mobile %></span>
          <span>ЁЯСд <%= y.gender === 'Male' ? 'M' : y.gender === 'Female' ? 'F' : '-' %> | ЁЯОВ <%= y.dob ? moment().diff(moment(y.dob), 'years') : '-' %> yrs</span>
        </div>
      </div>

      <!-- ЁЯМ┐ Onward Journey -->
      <div class="px-3 py-2" style="background: linear-gradient(to right, #e8f5e9, #c8e6c9);">
        <h6 class="fw-semibold text-danger mb-2">Phagwara тЖТ Mathura</h6>
        <p class="mb-0 text-dark">
          <strong>PNR:</strong> <%= y.onwardPNR || '-' %> |
          <strong>Coach:</strong> <%= y.onwardCoach || '-' %> |
          <strong>Seat:</strong> <%= y.onwardSeat || '-' %>
          <a href="/vrindavan-trip/ticket/<%= y.onwardPNR.trim() %>" class="btn btn-sm btn-outline-success me-2">ЁЯОл Show Ticket</a>
        </p>
      </div>

      <!-- ЁЯФБ Return Journey -->
      <div class="px-3 py-2" style="background: linear-gradient(to right, #e3f2fd, #bbdefb);">
        <h6 class="fw-semibold text-danger mb-2">Mathura тЖТ Phagwara</h6>
        <p class="mb-0 text-dark">
          <strong>PNR:</strong> <%= y.returnPNR || '-' %> |
          <strong>Coach:</strong> <%= y.returnCoach || '-' %> |
          <strong>Seat:</strong> <%= y.returnSeat || '-' %>
          <a href="/vrindavan-trip/ticket/<%= y.returnPNR.trim() %>" class="btn btn-sm btn-outline-primary me-2">ЁЯОл Show Ticket</a>
        </p>
        
      </div>

      <!-- ЁЯУЭ Remarks
      <% if (y.remarks && y.remarks.trim() !== '') { %>
        <div class="px-3 py-2" style="background-color: #fafafa;">
          <p class="mb-0"><strong>ЁЯУЭ Remarks:</strong> <%= y.remarks %></p>
        </div>
      <% } %> -->

    </div>
  <% }) %>
</div>


  <!-- ЁЯЦея╕П Desktop Table View -->
  <div class="table-responsive d-none d-md-block">
    <table class="table table-bordered table-striped">
      <thead class="table-danger text-center">
        <tr>
          <th>S.No</th>
          <th>Name</th>
          <th>Mobile</th>
          <th>M/F</th>
          <th>Age</th>
          <th>PGW PNR</th>
          <th>Coach#</th>
          <th>Seat#</th>
          <th>MTJ PNR</th>
          <th>Coach#</th>
          <th>Seat#</th>
        </tr>
      </thead>
      <tbody>
        <% yatraList.forEach((y, index) => { %>
          <tr class="text-center">
            <td><%= index + 1 %></td>
            <td class="text-start"><%= y.name %></td>
            <td><%= y.mobile %></td>
            <td><%= y.gender === 'Male' ? 'M' : y.gender === 'Female' ? 'F' : '-' %></td>
            <td><%= y.dob ? moment().diff(moment(y.dob), 'years') : '' %></td>
            <td><%= y.onwardPNR || '-' %></td>
            <td><%= y.onwardCoach || '-' %></td>
            <td><%= y.onwardSeat || '-' %></td>
            <td><%= y.returnPNR || '-' %></td>
            <td><%= y.returnCoach || '-' %></td>
            <td><%= y.returnSeat || '-' %></td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <!-- ЁЯУЭ Instructions -->
  <div class="alert alert-warning mt-5">
    <h5>ЁЯУЭ Instructions:</h5>
    <ol>
      <li>рдпрд╣ рдпрд╛рддреНрд░рд╛ рдЯреНрд░реЗрди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреА рдЬрд╛рдПрдЧреА тАФ рдХреЛрдЪ рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ 3AC (рдПрд╕реА) рдФрд░ рд╕реНрд▓реАрдкрд░ (рдиреЙрди-рдПрд╕реА) рдореЗрдВ рд╣реИред</li>
      <li>3AC рдпрд╛рддреНрд░рд╛ рдХрд╛ рдЕрдиреБрдорд╛рдирд┐рдд рдЦрд░реНрдЪ тВ╣3,500 рд╕реЗ тВ╣4,000 рддрдХ рд░рд╣реЗрдЧрд╛ред</li>
      <li>рд╕реНрд▓реАрдкрд░ (рдиреЙрди-рдПрд╕реА) рдХрд╛ рдЕрдиреБрдорд╛рдирд┐рдд рдЦрд░реНрдЪ рд▓рдЧрднрдЧ тВ╣2,500 рд░рд╣реЗрдЧрд╛ред</li>
      <li>рдпрд╣ рдХреЛрдИ рдЯреВрд░ рдкреИрдХреЗрдЬ рдирд╣реАрдВ рд╣реИред</li>
      <li>рд╣рдо рдПрдХ рд╕рдореВрд╣ рдХреЗ рд░реВрдк рдореЗрдВ рдорд┐рд▓рдХрд░ рдпрд╛рддреНрд░рд╛ рдХрд░ рд░рд╣реЗ рд╣реИрдВ тАФ рдпрд╣ рдПрдХ рд╕рд╣рднрд╛рдЧреА рдпрд╛рддреНрд░рд╛ рд╣реИред</li>
      <li>рд╣рдорд╛рд░реА рдЬрд┐рдореНрдореЗрджрд╛рд░реА рдХреЗрд╡рд▓ рдЯреНрд░реЗрди рдЯрд┐рдХрдЯ рдФрд░ рдордереБрд░рд╛ рд╕реЗ рд╡реГрдВрджрд╛рд╡рди рддрдерд╛ рд╡рд╛рдкрд╕реА рдХреЗ рд▓рд┐рдП Bus/Auto рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рддрдХ рд╕реАрдорд┐рдд рд╣реИред</li>
      <li>рднреЛрдЬрди, рдСрдЯреЛ рдпрд╛ рдЕрдиреНрдп рд╡реНрдпрдХреНрддрд┐рдЧрдд рдЦрд░реНрдЪреЛрдВ рдХреА рдЬрд┐рдореНрдореЗрджрд╛рд░реА рдпрд╛рддреНрд░рд┐рдпреЛрдВ рдХреА рд╕реНрд╡рдпрдВ рдХреА рд╣реЛрдЧреАред</li>
      <li>рдкрдВрдЬреАрдХрд░рдг 30 рдЕрдЧрд╕реНрдд рддрдХ рдпрд╛ рдЕрдзрд┐рдХрддрдо 62 рдпрд╛рддреНрд░рд┐рдпреЛрдВ рдХреЗ рдкреВрд░рд╛ рд╣реЛрддреЗ рд╣реА рдмрдВрдж рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред</li>
      <li>рдЖрд╢реНрд░рдо рдореЗрдВ 19 рдХрдорд░реЗ (рдкреНрд░рддрд┐ рдХрдорд░рд╛ 3-4 рд╡реНрдпрдХреНрддрд┐) 62 рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реИред</li>
      <li>рд╣рдо рдЖрд╢реНрд░рдо рд╕реЗ 2 рдирд╛рд╢реНрддреЗ рдФрд░ рд░рд╛рдд рдХреЗ рднреЛрдЬрди рдХреА рд╡реНрдпрд╡рд╕реНрдерд╛ рдкрд░ рдмрд╛рддрдЪреАрдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ тАФ рдЦрд░реНрдЪ рд╕рд╛рдЭрд╛ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред</li>
      <li>рдХрдорд░реЗ рдпрд╛ рд╣реЙрд▓ рдореЗрдВ рд░рд╣рдиреЗ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд░рд╛рд╢рд┐ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХреА рдЬрд╛рдПрдЧреАред</li>
      <li>рдпрд╣ рдПрдХ рдпреЛрдЧрд┐рдХ рдПрд╡рдВ рдЖрдзреНрдпрд╛рддреНрдорд┐рдХ рдпрд╛рддреНрд░рд╛ рд╣реИ тАФ рд╕рдордп рдорд┐рд▓рдиреЗ рдкрд░ рдзреНрдпрд╛рди, рдпреЛрдЧрдирд┐рджреНрд░рд╛ рдпрд╛ рдпреЛрдЧ рд╕рддреНрд░ рдЖрдпреЛрдЬрд┐рдд рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред</li>
      <li>рдХрд┐рд╕реА рднреА рдкреНрд░рд╢реНрди рдпрд╛ рд╕рд╣рд╛рдпрддрд╛ рд╣реЗрддреБ рдХреГрдкрдпрд╛ рд╣рдорд╛рд░реА рдЯреАрдо рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВред</li>
    </ol>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchInput = document.getElementById("searchInput");

    // All cards inside the mobile container
    const cardContainer = document.getElementById("yatraCards");

    searchInput.addEventListener("input", () => {
      const query = searchInput.value.toLowerCase();
      const cards = cardContainer.querySelectorAll(".participant-card");

      cards.forEach((card) => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(query) ? "block" : "none";
      });
    });

    // Clear search
    window.clearSearch = function () {
      searchInput.value = "";
      const cards = cardContainer.querySelectorAll(".participant-card");
      cards.forEach((card) => (card.style.display = "block"));
    };
  });

  function confirmDelete(id) {
    if (!confirm("Are you sure you want to delete this record?")) return;

    const spinner = document.getElementById("loadingSpinner");
    if (spinner) spinner.style.display = "block";

    fetch(`/vrindavan-trip/delete/${id}`, {
      method: "DELETE",
    })
      .then((res) => res.json())
      .then((data) => {
        if (spinner) spinner.style.display = "none";
        if (data.success) {
          alert("тЬЕ Deleted successfully");
          location.reload();
        } else {
          alert("тЭМ Delete failed");
        }
      })
      .catch((err) => {
        if (spinner) spinner.style.display = "none";
        alert("тЭМ Error deleting record");
      });
  }
</script>


<%- include('../partials/footer') %>
