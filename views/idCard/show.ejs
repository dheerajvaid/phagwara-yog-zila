<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<link rel="stylesheet" href="/css/idcard.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<div class="id-card-wrapper">
  <div id="card" class="id-card-horizontal">

    <div class="left-block">

      <img src="/images/logo-nbg.png" class="org-logo">
      <div class="tagline">‡§ú‡•Ä‡§ì ‡§î‡§∞ ‡§ú‡•Ä‡§µ‡§® ‡§¶‡•ã</div>

      <!-- Photo Box ONLY -->
      <div class="photo-box" id="photoPreview">
        <span style="font-size:10px; color:#7a3e1f;">Photo</span>
      </div>

    </div>

    <div class="right-block">

      <div class="org-title">‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§Ø‡•ã‡§ó ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§® (‡§™‡§Ç‡§ú‡•Ä.)</div>
      <div class="zila-title" style="line-height: 1.1;">

        <% if (kenderName) { %>
          <div><%= kenderName %></div>
        <% } %>

        <% if (ksheterName) { %>
          <div><%= ksheterName %></div>
        <% } %>

        <% if (zilaName) { %>
          <div><%= zilaName %></div>
        <% } %>

        <% if (prantName) { %>
          <div><%= prantName %></div>
        <% } %>

        <% if (!kenderName && !ksheterName && !zilaName && !prantName) { %>
          <div>Karo Yog Raho Nirog</div>
        <% } %>

      </div>

      <div class="info-box">
        <div class="info-label">üë§ NAME</div>
        <div class="info-value"><%= user.name.toUpperCase() %></div>

        <div class="divider"></div>

        <div class="info-label">üéÄ DESIGNATION</div>
        <div class="info-value"><%= user.roles.join(", ") %></div>

        <div class="divider"></div>

        <div class="info-label">üì≤ MOBILE</div>
        <div class="info-value">
          <%= user.mobile.replace(/(\d{5})(\d{5})/, '$1-$2') %>
        </div>

      </div>

    </div>

  </div>
</div>

<!-- UPLOAD BUTTON OUTSIDE THE CARD -->
<div class="download-container">
  
  <!-- üì∏ Upload Photo Button -->
  <label for="photoInput" class="btn btn-warning" style="margin-right: 10px;">
    Upload Photo
  </label>

  <!-- Hidden input -->
  <input type="file" accept="image/*" id="photoInput" style="display:none">

  <!-- ‚¨á Download Button -->
  <button class="btn btn-primary download-btn" onclick="downloadCard()">
    Download ID Card
  </button>
</div>

<script src="/js/idcard-download.js"></script>

<script>
document.getElementById('photoInput').addEventListener('change', function (event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function (e) {
    document.getElementById('photoPreview').innerHTML =
      `<img src="${e.target.result}">`;
  };
  reader.readAsDataURL(file);
});
</script>

<%- include('../partials/footer') %>
