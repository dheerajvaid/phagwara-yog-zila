<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BYS Phagwara Zila Directory</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Font and Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

  <style>
    @page {
      size: A4 portrait;
      margin: 15mm;
    }

    body {
      font-family: 'Roboto', sans-serif;
      font-size: 11pt;
      color: #000;
    }

    h1, h2, h3 {
      margin: 0;
      padding: 0;
    }

    h1 {
      font-size: 20pt;
      margin-bottom: 10px;
    }

    h2 {
      font-size: 16pt;
      margin-top: 20px;
      margin-bottom: 10px;
    }

    h3 {
      font-size: 13pt;
      margin-top: 15px;
      margin-bottom: 6px;
    }

    .section {
      margin-bottom: 20px;
      page-break-inside: avoid;
    }

    .divider {
      margin: 15px 0;
      border-top: 2px solid #ccc;
    }

    .member {
      margin: 4px 0;
    }

    .role-badge {
      background: #eee;
      padding: 2px 6px;
      font-size: 9pt;
      border-radius: 4px;
    }

    .address {
      font-size: 10pt;
      margin-bottom: 4px;
      color: #333;
    }

    .photo {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 4px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 10pt;
      margin-top: 8px;
    }

    th, td {
      border: 1px solid #999;
      padding: 6px;
      text-align: left;
    }

    .icon {
      margin-right: 5px;
    }
  </style>
</head>

<body>
  <h1>Bhartiya Yog Sansthan - Phagwara Zila Directory</h1>

  <!-- Zila Team -->
  <div class="section">
    <h2><i class="fas fa-users icon"></i>Zila Team</h2>
    <% zilas.forEach(zila => { %>
      <% saadhaks.filter(s => s.zila == zila._id).forEach(member => { %>
        <div class="member">
          <strong><%= member.name %></strong> ‚Äì 
          <span class="role-badge"><%= member.roles.join(', ') %></span> ‚Äì 
          üìû <%= member.mobile %>
        </div>
      <% }) %>
    <% }) %>
  </div>

  <!-- Ksheter Loop -->
  <% ksheters.forEach(ksheter => { %>
    <div class="section">
      <h2><i class="fas fa-map icon"></i><%= ksheter.name %></h2>

      <!-- Ksheter Team -->
      <% saadhaks.filter(s => s.ksheter == ksheter._id && !s.kender).forEach(member => { %>
        <div class="member">
          <strong><%= member.name %></strong> ‚Äì 
          <span class="role-badge"><%= member.roles.join(', ') %></span> ‚Äì 
          üìû <%= member.mobile %>
        </div>
      <% }) %>

      <!-- Kenders under this Ksheter -->
      <% kenders.filter(k => k.ksheter == ksheter._id).forEach(kender => { %>
        <div class="divider"></div>
        <h3><i class="fas fa-spa icon"></i><%= kender.name %></h3>
        <div class="address">üìç <%= kender.address %></div>

        <table>
          <thead>
            <tr>
              <th>Photo</th>
              <th>Name</th>
              <th>Role(s)</th>
              <th>Mobile</th>
            </tr>
          </thead>
          <tbody>
            <% saadhaks.filter(s => s.kender == kender._id).forEach(member => { %>
              <tr>
                <td>
                  <% if (member.photo) { %>
                    <img src="<%= member.photo %>" class="photo" />
                  <% } else { %>
                    -
                  <% } %>
                </td>
                <td><%= member.name %></td>
                <td><%= member.roles.join(', ') %></td>
                <td><%= member.mobile %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% }) %>
    </div>
  <% }) %>
</body>
</html>
