<%- include('../partials/header') %> <%- include('../partials/navbar') %>

<style>
  body {
    background: #f4f8f6;
  }

  .game-wrapper {
    max-width: 400px;
    margin: auto;
    padding: 8px;
  }

  .game-card {
    background: #ffffff;
    border-radius: 16px;
    box-shadow: 0 10px 28px rgba(0, 0, 0, 0.08);
    padding: 8px;
  }

  .game-title {
    text-align: center;
    font-weight: 700;
    color: #1b5e20;
    font-size: 1.35rem;
  }

  .game-subtitle {
    text-align: center;
    font-size: 0.9rem;
    color: #555;
    margin-bottom: 10px;
  }

  .game-top-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
  }

  .timer {
    font-weight: 700;
    color: #2e7d32;
  }

  .sequence-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
    margin-top: 14px;
  }

  .sequence-item {
    padding: 6px 8px;
    background: #f1f8e9;
    border-radius: 12px;
    border: 1px dashed #aed581;
    cursor: grab;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-weight: 600;
    color: #2e7d32;
    transition:
      transform 0.15s ease,
      background 0.2s ease;
  }

  .sequence-item.dragging {
    opacity: 0.5;
  }

  .sequence-number {
    background: #2e7d32;
    color: #fff;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
  }

  .btn-area {
    display: flex;
    gap: 10px;
    margin-top: 16px;
  }

  .btn-area button {
    flex: 1;
    border-radius: 10px;
    font-weight: 600;
  }

  .result-message {
    margin-top: 14px;
    text-align: center;
    font-weight: 600;
  }

  .success {
    color: #2e7d32;
  }

  .error {
    color: #c62828;
  }
</style>

<div class="game-wrapper">
  <div class="game-card">
    <div class="game-title">üßò ‡§Ü‡§∏‡§® ‡§ï‡•ç‡§∞‡§Æ ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£</div>
    <div id="sequenceTitle" class="text-center fw-bold text-success mt-1"></div>
    <div class="game-subtitle">‡§Ü‡§∏‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§∏‡§π‡•Ä ‡§ï‡•ç‡§∞‡§Æ ‡§Æ‡•á‡§Ç ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç</div>

    <div class="game-top-bar">
      <div class="timer">‚è± ‡§∏‡§Æ‡§Ø: <span id="timer">00:00</span></div>
      <button class="btn btn-outline-secondary btn-sm" onclick="resetGame()">
        üîÑ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§æ‡§∞‡§Ç‡§≠
      </button>
    </div>

    <div id="sequenceList" class="sequence-list"></div>

    <div class="btn-area">
      <button class="btn btn-success" onclick="checkSequence()">
        ‚úî ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§∞‡•á‡§Ç
      </button>
    </div>

    <div id="resultMessage" class="result-message"></div>
  </div>
</div>

<script>
  /* ================================
     SEQUENCE BANK (HINDI)
     ================================ */

  const SEQUENCE_BANK = [
    {
      name: "‡§Ö‡§∑‡•ç‡§ü‡§æ‡§Ç‡§ó ‡§Ø‡•ã‡§ó (8 ‡§Ö‡§Ç‡§ó)",
      steps: [
        "‡§Ø‡§Æ",
        "‡§®‡§ø‡§Ø‡§Æ",
        "‡§Ü‡§∏‡§®",
        "‡§™‡•ç‡§∞‡§æ‡§£‡§æ‡§Ø‡§æ‡§Æ",
        "‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡§æ‡§π‡§æ‡§∞",
        "‡§ß‡§æ‡§∞‡§£‡§æ",
        "‡§ß‡•ç‡§Ø‡§æ‡§®",
        "‡§∏‡§Æ‡§æ‡§ß‡§ø",
      ],
    },
    {
      name: "‡§Ø‡§Æ (‡§Ø‡•ã‡§ó ‡§ï‡•á 5 ‡§®‡§ø‡§Ø‡§Æ)",
      steps: ["‡§Ö‡§π‡§ø‡§Ç‡§∏‡§æ", "‡§∏‡§§‡•ç‡§Ø", "‡§Ö‡§∏‡•ç‡§§‡•á‡§Ø", "‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§ö‡§∞‡•ç‡§Ø", "‡§Ö‡§™‡§∞‡§ø‡§ó‡•ç‡§∞‡§π"],
    },
    {
      name: "‡§®‡§ø‡§Ø‡§Æ (‡§Ø‡•ã‡§ó ‡§ï‡•á 5 ‡§®‡§ø‡§Ø‡§Æ)",
      steps: ["‡§∂‡•å‡§ö", "‡§∏‡§Ç‡§§‡•ã‡§∑", "‡§§‡§™", "‡§∏‡•ç‡§µ‡§æ‡§ß‡•ç‡§Ø‡§æ‡§Ø", "‡§à‡§∂‡•ç‡§µ‡§∞ ‡§™‡•ç‡§∞‡§£‡§ø‡§ß‡§æ‡§®"],
    },
    {
      name: "‡§ß‡•ç‡§Ø‡§æ‡§® ‡§ï‡•Ä ‡§Ö‡§µ‡§∏‡•ç‡§•‡§æ‡§è‡§Å (4 ‡§ö‡§∞‡§£)",
      steps: ["‡§è‡§ï‡§æ‡§ó‡•ç‡§∞‡§§‡§æ", "‡§ß‡§æ‡§∞‡§£‡§æ", "‡§ß‡•ç‡§Ø‡§æ‡§®", "‡§∏‡§Æ‡§æ‡§ß‡§ø"],
    },
  ];

  /* ================================
     STATE
     ================================ */

  let sequence = [];
  let correctSequence = [];
  let currentSequenceName = "";
  let draggedIndex = null;
  let timerInterval = null;
  let secondsElapsed = 0;
  let lastSequenceIndex = -1;
  let gameCompleted = false;

  const sequenceList = document.getElementById("sequenceList");
  const resultMessage = document.getElementById("resultMessage");
  const timerEl = document.getElementById("timer");

  /* ================================
     INIT
     ================================ */

  function pickRandomSequence() {
    let randomIndex;
    do {
      randomIndex = Math.floor(Math.random() * SEQUENCE_BANK.length);
    } while (randomIndex === lastSequenceIndex);

    lastSequenceIndex = randomIndex;

    const selected = SEQUENCE_BANK[randomIndex];
    correctSequence = [...selected.steps];
    currentSequenceName = selected.name;
  }

  function initGame() {
    gameCompleted = false;
    pickRandomSequence();

    sequence = [...correctSequence].sort(() => Math.random() - 0.5);
    resultMessage.innerHTML = "";
    document.getElementById("sequenceTitle").innerText = currentSequenceName;

    resetTimer();
    startTimer();
    renderSequence();
  }

  /* ================================
     TIMER
     ================================ */

  function startTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      secondsElapsed++;
      const min = String(Math.floor(secondsElapsed / 60)).padStart(2, "0");
      const sec = String(secondsElapsed % 60).padStart(2, "0");
      timerEl.textContent = `${min}:${sec}`;
    }, 1000);
  }

  function resetTimer() {
    clearInterval(timerInterval);
    secondsElapsed = 0;
    timerEl.textContent = "00:00";
  }

  function stopTimer() {
    clearInterval(timerInterval);
  }

  /* ================================
     RENDER
     ================================ */

  function renderSequence() {
    sequenceList.innerHTML = "";

    sequence.forEach((asana, index) => {
      const item = document.createElement("div");
      item.className = "sequence-item";
      item.draggable = true;
      item.dataset.index = index;

      item.innerHTML = `
        <span>${asana}</span>
        <span class="sequence-number">${index + 1}</span>
      `;

      addDragEvents(item);
      sequenceList.appendChild(item);
    });
  }

  /* ================================
     DRAG ‚Üí INSERT
     ================================ */

  function addDragEvents(item) {
    item.addEventListener("dragstart", () => {
      if (gameCompleted) return;
      draggedIndex = Number(item.dataset.index);
      item.classList.add("dragging");
    });

    item.addEventListener("dragend", () => {
      item.classList.remove("dragging");
    });

    item.addEventListener("dragover", (e) => {
      e.preventDefault();
    });

    item.addEventListener("drop", () => {
      if (gameCompleted) return;
      const targetIndex = Number(item.dataset.index);
      insertItem(draggedIndex, targetIndex);
      renderSequence();
    });
  }

  function insertItem(fromIndex, toIndex) {
    if (fromIndex === toIndex || fromIndex === null || toIndex === null) return;

    const item = sequence.splice(fromIndex, 1)[0];
    sequence.splice(toIndex, 0, item);
  }

  /* ================================
     CHECK
     ================================ */

  function checkSequence() {
    const isCorrect = sequence.every(
      (asana, index) => asana === correctSequence[index]
    );

    if (isCorrect) {
      stopTimer();
      gameCompleted = true;
      resultMessage.innerHTML = "üåø ‡§∏‡§π‡•Ä ‡§ï‡•ç‡§∞‡§Æ! ‡§â‡§§‡•ç‡§§‡§Æ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏‡•§";
      resultMessage.className = "result-message success";
    } else {
      resultMessage.innerHTML = "‚ùå ‡§ï‡•ç‡§∞‡§Æ ‡§∏‡§π‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§";
      resultMessage.className = "result-message error";
    }
  }

  /* ================================
     RESET
     ================================ */

  function resetGame() {
    initGame();
  }

  initGame();
</script>

<%- include('../partials/footer') %>
