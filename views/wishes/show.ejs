<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<div class="container mt-4">
  <div class="text-center">
    <!-- Greeting Card -->
    <div id="greetingImageArea" class="bg-white mx-auto text-dark"
         style="padding: 1.5rem; border: 2px solid <%= color %>; border-radius: 0rem; max-width: 400px; box-shadow: 0 0 12px rgba(0,0,0,0.08);">

      <!-- Header Section -->
      <div class="d-flex align-items-center justify-content-center gap-3 mb-3">
        <div style="width: 60px; height: 60px; padding: 5px; border: 2px solid <%= color %>; border-radius: 50%; background-color: white;">
          <img src="/images/logo.jpg" alt="Logo" style="width: 100%; height: 100%; object-fit: contain; border-radius: 50%;">
        </div>
        <div>
          <h5 class="m-0 fw-bold" style="color: <%= color %>;"><%= title %></h5>
          <div class="small text-dark">
            <%= new Date().toLocaleDateString('hi-IN', { day: 'numeric', month: 'long', year: 'numeric' }) %>
          </div>
        </div>
      </div>

      <hr style="border-top: 2px solid <%= color %>; margin-bottom: 0.5rem;">
      <p class="fs-5 mb-2 fst-italic" style="white-space: pre-line;"><%= message %></p>
      <p class="text-center fw-bold" style="color: <%= color %>;">- <%= user.name %></p>
      <hr style="border-top: 2px solid <%= color %>; margin: 0.5rem 0;">

      <div class="mt-1 text-center fw-semibold">
        <a href="https://www.joinyog.in" target="_blank" class="text-decoration-none text-danger">www.joinyog.in</a>
      </div>
    </div>

    <!-- Buttons -->
    <div class="mt-3 d-flex justify-content-center gap-3">
      <button class="btn btn-primary" id="downloadGreetingBtn">‚¨áÔ∏è Download</button>
      <a href="/" class="btn btn-outline-primary">üôè ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶</a>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
  document.getElementById("downloadGreetingBtn").addEventListener("click", function () {
    const element = document.getElementById("greetingImageArea");

    html2canvas(element, {
      backgroundColor: '#ffffff',
      scale: 4,
      useCORS: true
    }).then(canvas => {
      const link = document.createElement("a");
      const today = new Date().toLocaleDateString('en-CA');

      // Set file name based on title
      const fileTitle = "<%= title.includes('‡§™‡•ç‡§∞‡§≠‡§æ‡§§') ? 'Good Morning' : 'Good Night' %>";
      link.download = `${fileTitle}-${today}.png`;

      link.href = canvas.toDataURL("image/png");
      link.click();
    });
  });
</script>


<%- include('../partials/footer') %>
